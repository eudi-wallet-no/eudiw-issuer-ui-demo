<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="nn-no">
<head>
    <th:block th:replace="~{fragments/general :: base_head_fragment}"></th:block>
    <title>Bevisgenerator</title>
    <style>
        .claim {
            display: flex;
            flex-direction: row;
            gap: 10px;
        }
    </style>
    <script>
        function addClaim() {
            const container = document.getElementById("claims");
            const index = container.children.length;

            const template = `
                <div class="claim">
                    <input class="ds-input" style="width: 20%;" type="text" name="claims[${index}].path" placeholder="Path" />
                    <input class="ds-input" style="width: 20%;" type="text" name="claims[${index}].name" placeholder="Name" />
                    <input class="ds-input" style="width: 20%;" type="text" name="claims[${index}].exampleValue" placeholder="Example Value" />
                    <button class="ds-button" data-color="danger" data-variant="tertiary" type="button" onclick="removeClaim(this)">Slett</button>
                </div>
            `;
            container.insertAdjacentHTML("beforeend", template);
        }

        function removeClaim(button) {
            button.parentElement.remove();
            reindexClaims();
        }

        function reindexClaims() {
            const claims = document.querySelectorAll("#claims .claim");
            claims.forEach((claim, i) => {
                claim.querySelectorAll("input").forEach(input => {
                    input.name = input.name.replace(/\[\d+]/, `[${i}]`);
                });
            });
        }
    </script>
</head>

<body>
<header th:replace="~{fragments/general :: page_header_fragment}"></header>

<main>
    <div>
        <h1 class="ds-heading" data-size="lg">
            Legg til bevistype
        </h1>
    </div>
    <div>
        <p class="ds-paragraph ds-alert">Det kan ta inntil ett minutt f√∏r bevistypen er tilgjengelig i utstederen.</p>
    </div>

    <form th:action="@{/add-credential-new}" th:object="${form}" method="post">

        <div style="display: grid; grid-template-columns: 60px 1fr; grid-gap: 10px; align-items: center; justify-content: center;">
            <label for="id-field" class="ds-label">VCT</label>
             <input id="id-field" style="width:50%;" class="ds-input" type="text" th:field="*{id}" />

            <label for="name-field" class="ds-label">Name</label>
            <input id="name-field" style="width:50%;" class="ds-input" type="text" th:field="*{name}" />
        </div>

        <hr/>

        <h3>Claims</h3>

        <div id="claims">
            <div class="claim" th:each="claim, stat : *{claims}">
                <input class="ds-input"
                       type="text"
                       th:field="*{claims[__${stat.index}__].path}"
                       placeholder="Path"/>

                <input class="ds-input"
                       type="text"
                       th:field="*{claims[__${stat.index}__].name}"
                       placeholder="Name"/>

                <input class="ds-input"
                       type="text"
                       th:field="*{claims[__${stat.index}__].exampleValue}"
                       placeholder="Example Value"/>

                <button class="ds-button" data-color="danger" data-variant="tertiary" type="button" onclick="removeClaim(this)">Slett</button>
            </div>
        </div>

        <button type="button" class="ds-button" data-variant="secondary" onclick="addClaim()">Add Claim</button>

        <hr/>

        <button class="ds-button" type="submit">Legg til bevistype</button>
    </form>

</main>

<footer th:replace="~{fragments/general :: page_footer_fragment(issuer=${issuerUrl})}"></footer>
</body>
</html>